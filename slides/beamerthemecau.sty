\newif\ifmetronav
\metronavtrue
\DeclareOption{SegoeUI}{
	\setsansfont[Ligatures=TeX]{Segoe UI Light}
}
\DeclareOption{nonav}{\metronavfalse}
\ProcessOptions

\RequirePackage{tikz}
\RequirePackage[overlay, absolute]{textpos}
\usetikzlibrary{arrows.meta, shapes.misc, calc}
\usepackage{mwe} % provides example image
\usepackage{calc}
%\RequirePackage{noto}
%\RequirePackage[sfdefault]{cabin}
\RequirePackage{lmodern}
\renewcommand*\familydefault{\sfdefault}
\usepackage[default]{raleway}
%\RequirePackage[default]{lato}
%\RequirePackage{PTSansNarrow}
%\RequirePackage{paratype}

%\definecolor{testbg}{HTML}{1F3044}
%\definecolor{testfg}{HTML}{FB9039}
%\definecolor{testfg2}{HTML}{646C79}
%\definecolor{testfg3}{HTML}{6EFFC4}
%\definecolor{testfg4}{HTML}{F8DD2E}

%\definecolor{testbg}{HTML}{425664}
\definecolor{testbg}{HTML}{E8EAE3}
\definecolor{testfg}{HTML}{00579c}%F5B935}
%\definecolor{testfg}{HTML}{000000}
%\definecolor{testfg2}{HTML}{E8EAE3}
\definecolor{testfg2}{HTML}{333333}
\definecolor{testfg3}{HTML}{DF3062}
\definecolor{testfg4}{HTML}{4BAC3F}
\definecolor{ksv_rot}{HTML}{eb1938}
\definecolor{ksv_blau}{HTML}{00579c}
\definecolor{ksv_grau}{HTML}{575759}



%\usebackgroundtemplate{
	%\begin{tikzpicture}[overlay,remember picture] 
	%\node[opacity=1,minimum width=\paperwidth,minimum height=\paperheight, fill=white, at=(current page.south east),anchor=south east,inner sep=0pt] {};
	%\node[anchor=north,fill=none,opacity=0.07] at ($(current page.north)+(3,3.01)$) {\includegraphics[width=1.5\textwidth,trim=-1cm 7cm 0cm 0]{siegel}};
	%\end{tikzpicture}
	
	%\begin{tikzpicture}[overlay,remember picture] 
	%\node[opacity=1,minimum width=\paperwidth,minimum height=\paperheight, fill=testbg, at=(current page.south east),anchor=south east,inner sep=0pt] {};


	%\node[anchor=north,fill=none] at ($(current page.north)+(0,5)$) {\includegraphics[width=1.5\textwidth]{shot}};
	%\node[opacity=1,minimum width=\paperwidth,minimum height=2cm, fill=white, rotate=0.25, at=(current page.north east),anchor=north east,inner sep=0pt] at ($(current page.north east)+(0,0.5)$) {};
		
	%


	%\end{tikzpicture}

%}

\newcommand{\metro@logo}{}
\renewcommand{\logo}[1]{\renewcommand{\metro@logo}{#1}}
\AtBeginDocument{\setbeamertemplate{logo}{}}
\setbeamercolor{background canvas}{bg=testbg}

\definecolor{MetroDarkBlue}{RGB}{11,50,97}
\definecolor{MetroBlue}{RGB}{31,73,125}
\definecolor{MetroRed}{RGB}{232,64,46}
\definecolor{MetroPurple}{RGB}{192,80,77}
\definecolor{MetroGreen}{RGB}{155,187,89}
\definecolor{MetroViolet}{RGB}{128,100,162}
\definecolor{MetroLightBlue}{RGB}{75,172,198}
\definecolor{MetroOrange}{RGB}{245,141,1}
\definecolor{MetroVisitedLink}{RGB}{198,217,240}
\definecolor{sthlmGrey}{RGB}{222,222,222} % HEX #f5f3ee
\definecolor{sthlmDarkGrey}{RGB}{51,51,51} % HEX #333333
\definecolor{sthlmLightBlue}{RGB}{137,183,226} % HEX #d6edfc
\definecolor{sthlmBlue}{RGB}{51,50,127} % HEX #006ebf
\definecolor{sthlmBlack}{RGB}{35,31,32} % HEX #d6edfc
\definecolor{sthlmCyan}{RGB}{20,133,146} % Hex #148592
\definecolor{sthlmLightGreen}{RGB}{164,199,59} % HEX #0d5f7f4
\definecolor{sthlmGreen}{RGB}{85,146,67} % #00867f
\definecolor{sthlmLightOrange}{RGB}{255,215,210} % HEX #ffd7d2
\definecolor{sthlmOrange}{RGB}{244,148,32} % HEX #dd4a2c
\definecolor{sthlmLightPurple}{RGB}{241,230,252} % HEX #f1e6fc
\definecolor{sthlmPurple}{RGB}{83,35,102} % HEX #5d237d
\definecolor{sthlmLightRed}{RGB}{254,222,237} % HEX #c40064
\definecolor{sthlmRed}{RGB}{216,42,47} % HEX #fedeed
\definecolor{sthlmYellow}{RGB}{252,191,10} % HEX #fcbf0a

% Define the base color set of the required colors
\definecolor{hks33}{RGB}{155,10,125}
\definecolor{hks33-darker}{RGB}{99,2,80}
\definecolor{hks33-vdark}{RGB}{86,0,68}


\definecolor{hks37k}{RGB}{086,035,129}
\definecolor{hks12k}{RGB}{228,049,023}
\definecolor{pantone382}{RGB}{153,194,033}
\definecolor{pantone292}{RGB}{106,172,218}
\definecolor{hks63k}{RGB}{057,132,046}
\definecolor{hks6k}{RGB}{242,148,000}
\definecolor{pantone315}{RGB}{000,103,124}
\definecolor{pantone280}{cmyk}{100,080,000,0.15}
\definecolor{pantone280}{RGB}{000,061,143}

% Assign the faculty colors
\colorlet{cau-maincolor}{hks33}         % University color
\colorlet{theo-maincolor}{hks37k}       % 
\colorlet{jura-maincolor}{hks12k}       %
\colorlet{medi-maincolor}{pantone382}   %
\colorlet{phil-maincolor}{pantone292}   %
\colorlet{aef-maincolor}{hks63k}        %
\colorlet{mnf-maincolor}{hks6k}         %
\colorlet{wiso-maincolor}{pantone315}   %
\colorlet{tf-maincolor}{pantone280}   % Technical faculty color

% Assign the faculty colors
\colorlet{cau-base}{testfg2}%hks33}         % University color\\
\colorlet{cau-base-mid}{testfg}%hks33-darker}         % University color
\colorlet{cau-base-dark}{testfg}%hks33-vdark}         % University color
\colorlet{cau-theo}{hks37k}       % 
\colorlet{cau-jura}{hks12k}       %
\colorlet{cau-medi}{pantone382}   %
\colorlet{cau-philfak}{pantone292}   %
\colorlet{cau-aef}{hks63k}        %
\colorlet{cau-mnf}{hks6k}         %
\colorlet{cau-wiso}{pantone315}   %
\colorlet{cau-tf}{pantone280}   % Technical faculty color


\usetikzlibrary{positioning, shapes,patterns,shadows.blur, arrows,decorations.text,arrows,automata,shadows,patterns,chains,bending,arrows.meta}

% Color Boxes
%\setbeamertemplate{footline}{\begin{beamercolorbox}[wd=0.25\textwidth,dp=1.5ex,leftskip=0.3cm,rightskip=0.3cm]{structure}
	%\begin{tikzpicture}[remember picture,overlay]
	%\foreach \n/\c in {1/theo,2/jura,3/medi,4/phil,5/aef,6/mnf,7/wiso,8/tf}{
	%	\fill[fill=\c-maincolor,anchor=south east] ($(current page.south east) + (0,12cm-\n*0.55cm-5.3cm)$) 
	%	rectangle ($(current page.south east) + (-.2cm,-\n*0.55cm + 12.15cm-5.3cm)$);
	%}
	%\end{tikzpicture}
%\end{beamercolorbox}
%\begin{tikzpicture}[remember picture,overlay]
		%\node[opacity=1,anchor=south west,inner sep=0pt,color=white!40!sthlmDarkGrey] at ($(current page.south west)+(0.25cm,-0.1cm)$) {\usebeamerfont{institute in head/foot}\insertauthor {~\small \inserttitle}};
		%\node[opacity=1,anchor=north east,inner sep=0pt,color=cau-base!30!white,rotate=-90] at ($(current page.south west)+(+0.25cm,-0.05cm)$) {\insertinstitute};
%\end{tikzpicture}
%}

\setbeamercolor{normal text}{fg=testfg2, bg=}
\setbeamercolor{background canvas}{bg=testbg}
\setbeamercolor{title page header}{fg=cau-base}
\setbeamercolor{section in toc}{parent={normal text}}
\setbeamercolor{subsection in toc}{parent={normal text}}
\setbeamercolor{item}{parent={normal text}}
\setbeamercolor{frametitle}{parent={normal text}, bg=testbg}
\setbeamercolor{block title}{parent={normal text}, fg=sthlmDarkGrey!30!white, bg=testbg}
\setbeamercolor{block body}{parent={normal text}, bg=testbg}
\setbeamercolor{block title example}{parent={normal text},fg=sthlmDarkGrey!90!white,bg=testbg}
\setbeamercolor{block body example}{parent={normal text}, bg=stestbg}
\setbeamercolor{logo}{parent={normal text}, bg=testbg}
\setbeamercolor{subtitle}{parent={normal text}}
\setbeamercolor{institute in head/foot}{fg=black,bg=black}
\setbeamercolor{headline}{parent={normal text}, bg=testbg}
\setbeamercolor{qed symbol}{parent={normal text}}

\setbeamerfont{footline}{size=\normalsize}
\setbeamerfont{logo}{size=\small}
\setbeamerfont{institute in head/foot}{size=\tiny}
\setbeamerfont{navigation symbols}{size=\small}
\setbeamerfont{section page}{size=\LARGE}
\setbeamerfont{title}{size=\huge}
\setbeamerfont{frametitle}{size=\huge}
\setbeamerfont{subtitle}{size=\normalsize}
\setbeamerfont{author}{size=\Large}
\setbeamerfont{date}{size=\Large}

\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{itemize items}[circle]
%\setbeamertemplate{footline}{
%  \leavevmode\hbox{%
%  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,left, leftskip=0.4cm]{institute in head/foot}%
%    \usebeamerfont{institute in head/foot}\insertinstitute
%  \end{beamercolorbox}%
%  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,center]{logo}%
%    \usebeamerfont{logo}\ifnum\thepage>1\relax\metro@logo\fi
%  \end{beamercolorbox}%
%  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,right, rightskip=0.4cm]{navigation symbols}%
%    \usebeamerfont{navigation symbols}\metro@navigation
%  \end{beamercolorbox}}%
%  \vskip0pt % what's that for?
%}

\newcommand{\metro@navigation}{% this uses the commands defined in beamerbasenavigation.sty
	\ifmetronav
	\begin{tikzpicture}[testbg, very thick, arrows=-{Straight Barb[length=3pt]}]
	\draw circle[radius=.25];
		\draw (.18,0) -- (-.18,0);
    	\node[rectangle]{\hyperlinkframeendprev{\phantom{\rule{.5cm}{.5cm}}}};
    \draw (.7,0) circle[radius=.25];
    	\filldraw (.62,.08) circle[radius=.05]
				  (.78,.08) circle[radius=.05]
				  (.62,-.08) circle[radius=.05]
				  (.78,-.08) circle[radius=.05];
		\node[rectangle] at (.7,0) {\hyperlinkpresentationstart{\phantom{\rule{.5cm}{.5cm}}}};
    \draw (1.4,0) circle[radius=.25];
  		\draw (1.22,0) -- (1.58,0);
  		\node[rectangle] at (1.4,0) {\hyperlinkframestartnext{\phantom{\rule{.5cm}{.5cm}}}};
    \draw (2.1,0) circle[radius=.25];
    	\node[cross out, draw] at (2.1,0){};
    	\node[rectangle] at (2.1,0){\Acrobatmenu{FullScreen}{\phantom{\rule{.5cm}{.5cm}}}};
	\end{tikzpicture}
	\fi
}

\setbeamertemplate{title page}{%
	\begin{textblock*}{12cm}(1cm,3cm)
    \begin{beamercolorbox}[wd=11cm, dp=0.4cm, ht=1cm, leftskip=0.1cm]{title page header}
      \usebeamerfont{title}

	  \begin{tikzpicture}[remember picture, overlay]
		%\node[anchor=north west] (t)  at ($(current page.north west)+(-0.15,0.15)$)  {\includegraphics[]{twitch_background}};
		\node[anchor=north west] (0)  at (1,-0.5)  {};
	  
		\coordinate (W1) at ($(0)+(2,0.15)$);
		\coordinate (W2) at ($(0)+(0.5,0.4)$);
		\coordinate (W3) at ($(0)+(-0.15,0.05)$);
		\coordinate (W4) at ($(0)+(1.45,-0.8)$);
		\draw [draw=none,fill=testfg2,opacity=0.1] plot [smooth cycle] coordinates {(W1) (W2) (W3) (W4)};
	  
	  
		\coordinate (V1) at ($(0)+(2.1,0.1)$);
		\coordinate (V2) at ($(0)+(1,0.2)$);
		\coordinate (V3) at ($(0)+(1.25,-0.5)$);
		\coordinate (V4) at ($(0)+(1,-0.7)$);
		\draw [draw=none,fill=ksv_rot!80!ksv_grau] plot [smooth cycle] coordinates {(V1) (V2) (V3) (V4)};
	  
		\coordinate (U1) at ($(0)+(1.3,0.25)$);
		\coordinate (U2) at ($(0)+(0,0)$);
		\coordinate (U3) at ($(0)+(-0.25,0)$);
		\coordinate (U4) at ($(0)+(0.6,-0.75)$);
		\draw [draw=none,fill=white] plot [smooth cycle] coordinates {(U1) (U2) (U3) (U4)};
	  
	  
		\coordinate (U1) at ($(0)+(1,0.25)$);
		\coordinate (U2) at ($(0)+(0,0)$);
		\coordinate (U3) at ($(0)+(-0.25,-0.5)$);
		\coordinate (U4) at ($(0)+(0.3,-0.5)$);
		\draw [draw=none,fill=ksv_blau] plot [smooth cycle] coordinates {(U1) (U2) (U3) (U4)};
\end{tikzpicture}

     \begin{tikzpicture}[remember picture, overlay, node distance=3.5cm] 
	   \begin{scope}[xshift=0.0cm,yshift=0.55cm]
	      %\node[color=white,fill=cau-base,anchor=west,font=\bfseries\footnotesize,align=center] (X) at (0,0) {Z3\hspace*{0.2cm}\tiny str\hspace*{0.23cm}\large3~\normalfont RE};
	      %\draw[white,line width=0.5pt] (1.2,-0.1575) -- (1.2,0.4);
	      %\draw[white,line width=0.5pt] (0.7,0.0875) -- (0.7,-0.4);
	    \end{scope}
      	% \node[color=testfg2,fill=none,font=\large,text width=25cm,minimum width=20cm,minimum height=20cm,anchor=west,fill=testfg2] (3) at (-2,0) {};
      	% \node[color=testfg2,fill=none,font=\large,text width=10cm,anchor=west,fill=testbg,text width=11cm,minimum height=3cm,rounded corners=10pt,rotate=-0.5] (3) at (-0.5,-0.5) {};
      
	      \node[color=white,white,draw=cau-base,rounded corners=3pt,fill=cau-base,anchor=west,font=\Large] (title) at (0.5cm,-0.25cm) {\inserttitle};
	      \node[color=testfg2,fill=none,font=\normalsize,text width=12cm,anchor=west] (2) at ($(title.east)$)  {\insertauthor};
      \node[color=testfg2,fill=none,font=\large,text width=10cm,anchor=west] (3) at (0,-1.3) {\insertinstitute};
      \end{tikzpicture}      
      
      %
    \end{beamercolorbox}%
    \end{textblock*}
    \begin{textblock*}{12cm}(1cm,4.7cm)
		\begin{beamercolorbox}[leftskip=0.1cm]{subtitle}
	      \usebeamerfont{subtitle}\insertsubtitle%
	    \end{beamercolorbox}
    \end{textblock*}
    \begin{textblock*}{\paperwidth}[1,0](\paperwidth,0.3cm)
	    \begin{beamercolorbox}[right,rightskip=0.2cm]{logo}
	      \usebeamerfont{logo}\metro@logo
    	\end{beamercolorbox}
    \end{textblock*}

}

\setbeamertemplate{frametitle}{


%%%%

%\vspace*{0.3cm}
%\begin{beamercolorbox}[wd=\textwidth, dp=0.3cm, ht=0.9cm, leftskip=0.2cm]{frametitle}
%      \usebeamerfont{frametitle}\insertframetitle%
%\end{beamercolorbox}

%\begin{tikzpicture}[remember picture,overlay]
%\node[opacity=0.5,anchor=north east,inner sep=10pt,color=cau-base!80!white,fill=sthlmDarkGrey!10!white,rounded corners=3pt,minimum height=0.8cm] at ($(current page.north east) + (0.3cm,-0.5cm)$) {\insertframetitle};
%\node[opacity=1,anchor=north east,inner sep=10pt,color=cau-base!80!white,rounded corners=5pt,minimum height=1cm] at ($(current page.north east) + (0.3cm,-0.5cm)$) {\insertframetitle};
%\end{tikzpicture}

\begin{tikzpicture}[remember picture, overlay] 
%\node[color=white,fill=cau-base,anchor=west,font=\Large] (1) at ($(current page.north west) + (1.3cm,-1cm)$) {\MakeUppercase{\insertframetitle}};
\node[color=white,white,draw=cau-base,rounded corners=3pt,fill=cau-base,anchor=west,font=\large] (1) at ($(current page.north west) + (1.3cm,-1cm)$) {\MakeUppercase{\insertframetitle}};
\node[color=cau-base!70!testbg,fill=none,anchor=east,font=\Large] (2) at ($(current page.north east) + (-0.5cm,-1cm)$) {\insertframesubtitle};
%\node[color=white,fill=none,anchor=north west] (2) at ($(current page.north west) + (0.25cm,-0.75cm)$) {\includegraphics[trim=0cm 1.5cm 4.5cm 0cm, clip=true, height=0.5cm]{uniLogo}};
%\node[testfg,draw=testfg,rounded corners=3pt,fill=testbg!90!testfg,font=\tiny] (3) at ($(current page.south east) + (-0.75cm,0.75cm)$) {\thepage};
\node[white,draw=cau-base,minimum width=1.5cm,minimum height=1.5cm,rounded corners=3pt,fill=cau-base,font=\tiny,rotate=10] (3) at ($(current page.south east) + (0cm,0cm)$) {};
\node[cau-base,rotate=10,font=\small] (3) at ($(current page.south east) + (-0.75cm,0.9cm)$) {\insertframenumber{}}; %{\thepage};
\node[color=cau-base,font=\tiny,anchor=east,font=\tiny] (3) at ($(current page.south east) + (-0.75cm,0.25cm)$) {\MakeUppercase{\inserttitle}};
\end{tikzpicture}


  \begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=0.75cm,semithick,remember picture,overlay]
  %\node[anchor=north west] (t)  at ($(current page.north west)+(-0.15,0.15)$)  {\includegraphics[]{twitch_background}};
  \node[anchor=north west] (0)  at ($(current page.north west)+(-0.25,0.6)$)  {};

  \coordinate (W1) at ($(0)+(4.6,0.35)$);
  \coordinate (W2) at ($(0)+(0,0)$);
  \coordinate (W3) at ($(0)+(-0.15,-1.85)$);
  \coordinate (W4) at ($(0)+(1.45,-0.8)$);
  \draw [draw=none,fill=testfg2,opacity=0.1] plot [smooth cycle] coordinates {(W1) (W2) (W3) (W4)};


  \coordinate (V1) at ($(0)+(3.1,0.25)$);
  \coordinate (V2) at ($(0)+(0,0)$);
  \coordinate (V3) at ($(0)+(-0.25,-1.8)$);
  \coordinate (V4) at ($(0)+(1.1,-0.8)$);
  \draw [draw=none,fill=ksv_rot!80!ksv_grau] plot [smooth cycle] coordinates {(V1) (V2) (V3) (V4)};

  \coordinate (U1) at ($(0)+(1.8,0.25)$);
  \coordinate (U2) at ($(0)+(0,0)$);
  \coordinate (U3) at ($(0)+(-0.25,-1.65)$);
  \coordinate (U4) at ($(0)+(0.6,-0.75)$);
  \draw [draw=none,fill=white] plot [smooth cycle] coordinates {(U1) (U2) (U3) (U4)};


  \coordinate (U1) at ($(0)+(1.6,0.25)$);
  \coordinate (U2) at ($(0)+(0,0)$);
  \coordinate (U3) at ($(0)+(-0.25,-1.5)$);
  \coordinate (U4) at ($(0)+(0.3,-0.5)$);
  \draw [draw=none,fill=ksv_blau] plot [smooth cycle] coordinates {(U1) (U2) (U3) (U4)};



  %\node[anchor=north west, rotate=38] (SH)  at ($(current page.north west)+(-0.5,-0.1)$)  {\resizebox{0.75cm}{!}{\includegraphics[page=1]{sh.pdf}}};




\end{tikzpicture}

\vspace*{-0.65cm}


}

\setbeamertemplate{block begin}{
	\vskip\baselineskip
	\begin{beamercolorbox}[wd=\textwidth, ht=0.5cm, dp=0.2cm, leftskip=0.2cm]{block title}%
		\usebeamerfont*{block title}{\rule[-0.4ex]{0mm}{2ex}\insertblocktitle}%
	\end{beamercolorbox}%
	{\nointerlineskip\vskip-0.5pt}%
	\usebeamerfont{block body}%
	\begin{beamercolorbox}[wd=\textwidth, leftskip=0.2cm, dp=0.2cm]{block body}%
    \vskip-.75ex\vbox{}%
}
\setbeamertemplate{block end}{
	\end{beamercolorbox}
	\vspace*{.25cm}
}

\setbeamertemplate{block example begin}{
	\vskip\baselineskip
	\begin{beamercolorbox}[wd=\textwidth, ht=0.5cm, dp=0.2cm, leftskip=0.2cm]{block title example}%
		\usebeamerfont*{block title example}{\rule[-0.4ex]{0mm}{2ex}\insertblocktitle}%
	\end{beamercolorbox}%
	{\nointerlineskip\vskip-0.5pt}%
	\usebeamerfont{block body example}%
	\begin{beamercolorbox}[wd=\textwidth, leftskip=0.2cm, dp=0.2cm]{block body example}%
    \vskip-.75ex\vbox{}%
}
\setbeamertemplate{block example end}{
    \end{beamercolorbox}
    \vspace*{.25cm}
}